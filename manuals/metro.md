
# 配送計画最適化システム METRO (MEta Truck Routing Optimizer) ユーザーマニュアル

## 1. アプリケーション概要

本アプリケーションは、複数の車両を用いて荷物の「配送（ジョブ）」や「拠点間輸送（シップメント）」を行う際の、最も効率的な訪問順序とルートを算出するシステムです。車両の積載容量、稼働時間、作業員のスキル、および法的な休憩時間などの複雑な制約をすべて考慮し、総コストや移動距離を最小化する最適な運行計画を自動作成します。

## 2. 設定項目（入力データ）

### 2-1. 車両の設定

配送業務に使用する車両のスペックと稼働条件を設定します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 車両管理番号 | 各車両を識別するための固有の番号。 | 重複しない数値を入力してください。 |
| 出発地点 | 運行を開始する拠点の位置情報。 | 緯度と経度のペアで指定します。 |
| 到着地点 | 最終的に帰還する拠点の位置情報。 | 運行終了後の戻り先を指定します。 |
| 積載容量 | 車両が一度に運べる最大量。 | 重量や容積など、複数の基準で制限をかけられます。 |
| 対応可能スキル | 当該車両やドライバーが対応可能な作業種別。 | 資格が必要な作業などを数値で指定します。 |
| 稼働時間枠 | 車両が稼働可能な時間帯。 | 開始時刻と終了時刻を秒単位（0〜86400）で指定します。 |
| 適用休憩プラン | 運行中に取得させる休憩の設定。 | あらかじめ定義した休憩設定を紐付けます。 |

### 2-2. 配送・集荷案件（ジョブ）の設定

単一の地点で発生する配送または集荷の案件を設定します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 案件番号 | 案件を識別するための管理番号。 | 固有の数値を入力してください。 |
| 案件名 | 納品先名や作業内容のメモ。 | 任意。実務上分かりやすい名称を推奨します。 |
| 訪問先住所 | 作業を行う地点の位置情報。 | 緯度と経度を指定します。 |
| 準備時間 | 駐車や受付など、作業前後に要する固定時間。 | 秒単位で入力します（例：10分＝600）。 |
| 作業時間 | 積み込みや荷降ろしに要する正味の時間。 | 秒単位で入力します。 |
| 配達量 | 当該地点で届ける荷物の量。 | 車両容量の単位と一致させてください。 |
| 集荷量 | 当該地点で回収する荷物の量。 | 車両容量の単位と一致させてください。 |
| 必須スキル | その作業を行うために必要な条件。 | 車両の「対応可能スキル」と合致する必要があります。 |
| 優先度 | 配送の重要度。 | 0（標準）から100（最高）の範囲で設定します。 |
| 訪問可能時間帯 | 顧客が指定する受け取り時間枠。 | 複数の時間枠（午前中と午後など）の設定が可能です。 |

### 2-3. 拠点間輸送（シップメント）の設定

特定の地点で積み込み、別の地点で降ろす「対になった輸送」を設定します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 積込地点情報 | 荷物をピックアップする場所の詳細。 | 位置、準備時間、作業時間、時間枠を設定します。 |
| 降ろ地点情報 | 荷物を届ける場所の詳細。 | 積込地点と同様の項目を設定します。 |
| 輸送量 | 運搬する荷物の量。 | 積込から降ろしまで車両の容量を占有します。 |
| 優先度 | 輸送の重要度。 | 0〜100の範囲で設定します（標準は100）。 |

### 2-4. 休憩の設定

ドライバーの労務管理に必要な休憩時間を定義します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 休憩時間枠 | 休憩を取得しなければならない時間帯。 | 開始可能時刻と終了制限時刻を指定します。 |
| 休憩時間 | 停止して休憩する長さ。 | 秒単位で指定します（例：1時間＝3600）。 |

## 3. 適用されるルール（制約条件）

最適化計算において、以下のルールが厳守されます。

* **時間枠の遵守**: すべての訪問は、指定された訪問可能時間帯（タイムウィンドウ）内に行われます。
* **積載制限**: 車両に積まれる荷物の合計は、設定された最大容量を決して超えません。
* **スキルマッチング**: 特定のスキルが必要な案件には、そのスキルを持つ車両のみが割り当てられます。
* **輸送順序**: 拠点間輸送（シップメント）の場合、必ず「積み込み」を「荷降ろし」より先に行います。
* **休憩の強制**: 指定された時間枠内に、必要な長さの休憩がルートの中に組み込まれます。
* **優先順位の考慮**: 全ての案件を回れない場合、優先度の高い案件を優先的にルートに組み込みます。

## 4. 出力結果

計算完了後、以下の情報が提供されます。

* **運行概要**: 総コスト、稼働ルート数、未割り当て案件数、総移動距離、総稼働時間、総待機時間。
* **車両別ルート詳細**: 各車両が「いつ」「どこへ」行き、「何を」するかの時系列スケジュール。
* **作業指示**: 各地点への到着予定時刻、作業開始時刻、出発時刻、およびその時点での積載量。
* **制約違反チェック**: 配送時間の遅延や容量オーバーなど、運用上のルール違反が発生していないかの確認結果。
* **ルート形状**: 地図上に描画するためのルートパスデータ。

## 5. アプリケーション操作ガイド

### サイドバー設定
* **Number of Jobs**: 生成する配送案件（ジョブ）の数。
* **Number of Vehicles**: 使用する車両の数。
* **Generate Random Problem**: 設定した条件で関東エリア（擬似）のランダムな問題を生成します。
* **Optimize**: 最適化を実行します。

### 結果表示 (Result Tab)
* **Optimization Summary**: ソルバーのログや要約情報。
* **Routes Visualization**: 
    * **Detailed Route**: チェックを入れると地図上に詳細な経路（道路形状）を描画します。
    * **Map**: 各スポット（Start, End, Pickup, Delivery）とルートを表示するインタラクティブマップ。
* **Gantt Chart**: 各車両のスケジュール（移動、待機、作業、休憩）を時系列で可視化します。