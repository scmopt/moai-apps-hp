# MOAI Inventory Optimizer ユーザーマニュアル

このマニュアルでは、MOAI Inventory Optimizer Webアプリケーションの使用方法と、実装されている在庫最適化手法の概要について説明します。

---

## 1. はじめに

### MOAI Inventory Optimizer とは

MOAI Inventory Optimizer は、単なる在庫の記録や参照を行う管理システムではなく、**数理最適化アルゴリズムをエンジンとした意思決定支援ツール**です。在庫管理の目的である「総コストの最小化」と「適切なサービスレベルの維持」を数学的根拠に基づいて実現します。

### 最適化の基本概念：トレードオフの解消

在庫管理における意思決定には、常に以下の要素間のトレードオフが存在します。

| コスト要素 | 在庫を増やすと… | 在庫を減らすと… |
|---|---|---|
| **在庫保持費用** | 保管コスト・資本コストが増加 ↑ | コスト削減 ↓ |
| **品切れ費用** | 欠品リスク低下 ↓ | 機会損失・顧客満足度低下 ↑ |
| **発注固定費** | まとめ発注で固定費削減 ↓ | 頻繁な少量発注で固定費増大 ↑ |

本システムは、これらの相反するコストを同時に考慮し、**「いつ、どれだけ発注すべきか」** という最適解を導き出します。

---

## 2. 利用ガイド

### モジュールの選択

アプリケーションはタブで整理されており、各タブが異なる最適化問題（EOQ、ニュースベンダー、MEIOなど）を表しています。解決したい在庫問題に対応するタブをクリックしてください。

### 一般的なワークフロー

1. **パラメータの入力**: フォームのフィールドに問題のデータを入力します。
    * **スカラー値**: 単純なコストなどは数値を入力します（例: `10.5`）。
    * **リスト**: 時間変動や複数拠点のパラメータは、カンマ区切りの値を入力します（例: `10, 20, 15, 30`）。
    * **ネットワークエディタ**: MEIOやGSMモジュールでは、インタラクティブなネットワークエディタを使用してノードやエッジを追加するか、「Load Sample」ボタンを使用してサンプルデータを読み込みます。
2. **計算の実行 (Calculate)**: フォーム下部の **Calculate** ボタンをクリックします。
3. **結果の確認**:
    * 最適なポリシーパラメータ（発注量 $Q$、再発注点 $r$ など）が表示されます。
    * 最小化された期待コストが表示されます。
    * シミュレーションや動的モデルの場合、時系列データのグラフや表が表示されることがあります。

---

## 3. 古典的在庫モデル：単一地点・一定需要

在庫管理理論の出発点となる、需要が安定している環境を想定したモデルです。

### 3.1 EOQ（経済的発注量）モデル

「ハリス（Harris）のモデル」としても知られる、最も古典的なモデルです。発注固定費と在庫保持費用のトレードオフを最小化する発注量（$Q$）を決定します。

* **仮定**: 需要は一定かつ確定的。リードタイムなし（または一定）。欠品は許容しない。
* **特徴**: 非常にシンプルな公式で最適解が得られ、需要変動が極めて少ない製品の基本発注量を決めるのに適しています。
* **入力**: 固定費用 ($K$)、保持費用 ($h$)、需要率 ($\lambda$)
* **出力**: 最適発注量 ($Q^*$)、最小コスト

### 3.2 同時発注問題 (JRP)

複数の品目が主要な固定発注費用を共有しつつ、個別の発注費用も持つ場合の、Silverのヒューリスティック解法です。

* **入力**: 共有固定費用 ($K$)、個別固定費用 ($k_i$)、保持費用 ($h_i$)、需要率 ($\lambda_i$)
* **出力**: 最適発注量 ($Q_i$)、基本サイクルタイム ($T$)、発注倍数 ($m_i$)

### 3.3 ニュースベンダー問題 (Newsvendor Problem)

需要が不確実（確率的）な場合に、**在庫過剰による廃棄・保持コスト**と**品切れによる機会損失**のバランスを最適化する単一期間モデルです（新聞、生鮮食品などが典型例）。

* **目的**: 最適期末在庫レベル（ベースストックレベル：$S^*$）を決定します。この値に到達するように補充を行う「Order-up-to」方針の基礎となります。
* **手法**: クリティカル・フラクタイル（臨界分位点）公式を使用
* **需要分布の扱い**:
    * **正規分布**: 平均（$\mu$）と標準偏差（$\sigma$）を用いて定義します。
    * **ポアソン分布**: 平均パラメータ1つで定義されます。マイナスの値をとらないため、低頻度な需要のモデル化に適しています。
* **リードタイム**: 発注から納品までのリードタイム期間中の需要変動を考慮した計算が可能です。
* **入力**: 保持費用、欠品費用、需要の平均（正規分布の場合は標準偏差も）
* **出力**: 最適発注補充点 ($S^*$)、期待コスト

---

## 4. 高度な単一地点在庫モデル：固定費と変動需要への対応

実務において避けて通れない「発注固定費」と「確率的な需要」を同時に扱うモデル群です。

### 4.1 (r, Q) ポリシー（RQモデル）

固定費用、在庫費用、品切れ費用のすべてが存在する場合に、在庫ポジションが再発注点 $r$ まで下がったときに固定量 $Q$ を発注する連続レビューシステムの最適化です。

* **決定パラメータ**: 発注点（$r$）と固定発注量（$Q$）の2つ
* **最適化の重要性**: 多くの実務では $Q$ を先に決めてから $r$ を計算しがちですが、本システムでは $r$ と $Q$ が相互に影響し合うことを考慮し、同時に最適化します。
* **近似手法**:
    * **EIL (Expected Inventory Level)**: 期待在庫レベルを用いて最適ポリシーを近似
    * **EOQB (EOQ with Backorders)**: バックオーダーを許容するように拡張した決定論的EOQ
    * **EOQSS (EOQ with Safety Stock)**: $Q$（EOQ由来）と $r$（安全在庫由来）を分離して計算
    * **Loss Function**: より高い精度のために厳密な損失関数を使用
* **入力**: コスト（固定、保持、欠品）、需要（平均、標準偏差）、リードタイム
* **出力**: 各近似手法による最適な $(r, Q)$ のペアとコスト

### 4.2 (s, S) ポリシー（SSポリシー）

在庫理論の標準的な教科書に必ず登場するモデルであり、固定費がある場合の最適方策として知られています。在庫ポジションが $s$ 以下の場合に、$S$ まで補充するように発注します。

* **RQモデルとの比較**: 需要が大きく、発注点（$s$）を大幅に割り込む（アンダーシュートする）場合でも、常に目標レベル（$S$）まで補充するため、RQモデルよりも柔軟で精度の高い管理が可能です。
* **手法**:
    * **Discrete Exact**: ポアソン需要に対する大域的最適解を計算（厳密解）
    * **Power Approximation**: 正規分布の需要パラメータを使用した高速なヒューリスティック近似
* **入力**: コスト、需要パラメータ
* **出力**: 最適再発注点 ($s$) と 発注補充点 ($S$)

### 4.3 ワグナー・ウィッティン法（Wagner-Whitin）

期間ごとに確定的な需要が判明している（動的需要）場合に、動的計画法（DP）を用いて最適化する手法です。

* **トレードオフ**: 特定の期間の発注固定費と、将来の需要を先取りして保管する在庫保持費用のトレードオフを扱います。
* **特徴**: 毎期発注するのではなく、数期分の需要をまとめて発注するため、発注パターンが「0か、複数期分を満たすプラスの値か」という特徴的な挙動を示します。
* **手法**: 計算複雑度 $O(T^2)$ の動的計画法アルゴリズム
* **入力**: 期間数、期間ごとの需要、保持費用、固定発注費用
* **出力**: 各期間の最適発注量、総コスト

---

## 5. 有限期間の動的在庫モデル

実務上の「曜日別需要」などの非定常な変動に、動的計画法（DP）を用いて対応するモデルです。

### 確率的有限期間 (Stochastic Finite Horizon)

確率的需要の下での有限計画期間における最適な非定常 $(s_t, S_t)$ ポリシーを見つけます。

* **非定常需要への対応**: 多くの在庫管理ソフトが「需要は常に一定」という前提（定常需要）を置いていますが、MOAI Inventory Optimizer は、スーパーマーケットの週末の混雑のような「日ごとに異なる需要特性」を正確に扱えます。
* **入力パラメータ**: 期間中の需要分布に加え、「初期在庫」および「最終期末の目標在庫（ターゲット）」の設定が必要です。
* **実務的メリット**: 日ごとに固定費用や需要が異なる状況において、日別に異なる最適 $(s, S)$ 政策を算出できます。これは、理論と実務の乖離を埋める強力な機能です。
* **手法**: 最終期間から遡って計算する確率的動的計画法
* **入力**: 期間数、期間ごとの需要パラメータ（平均、標準偏差）およびコスト
* **出力**: 各期間 $t$ における最適な $(s_t, S_t)$ ポリシー

---

## 6. マルチエシェロン（多段階）在庫最適化

工場・倉庫・店舗といったサプライチェーン全体の在庫を統合的に最適化します。

### 6.1 MEIO Serial SSM（直列ネットワークモデル）

**確率的サービスモデル (SSM)** を使用した、**直列システム**（ステージが一直線に連なるサプライチェーン）のための多段階在庫最適化です。

* **エシェロン在庫の概念**: 特定の拠点単体ではなく、その拠点以降の全システムに含まれる在庫を「エシェロン在庫」として捉えます。
* **エシェロン保持費用**: 各段階で付加されるコストを考慮し、サプライチェーン全体で費用を最小化する各地点のベースストックレベルを、畳み込み計算を伴う高度なDPで導き出します。
* **手法**: Chen-Zheng (1994) のアルゴリズムを実装
* **入力**: ノード数、エシェロン保持費用、リードタイム、最下流ノードの需要パラメータ
* **出力**: システム全体のコストを最小化する、全ステージの最適基準在庫レベル

### 6.2 GSM（保証サービスモデル / Guaranteed Service Model）

別名 Graves モデル。2000年代以降に普及した、大規模かつ複雑なネットワークに適した理論です。サプライチェーン内の**コミットされたサービス時間 (CST)** を最適化し、内部ステージへのサービス（納期遵守）を100%保証しつつ、安全在庫投資を最小化します。

* **特徴**: 各拠点が下流に対して「一定のサービスタイム（納品時間）内に必ず届ける」という約束を交わすと仮定します。この仮定はある種「大胆」な簡略化ですが、この前提を置くことで複雑な多段階ネットワークにおいても極めて高速に計算を行うことが可能になります。
* **対象**: 直列ラインおよびスパニングツリー
* **入力**: ネットワーク構造、処理時間、最大サービス時間、コスト
* **出力**: 各ステージの最適なコミット済みサービス時間

### 6.3 MEIO General（一般ネットワーク）とシミュレーション最適化

分岐や合流がある**一般的なネットワークトポロジー**（配送ネットワーク、組立システムなど）に対する基準在庫ポリシーの最適化です。厳密な数式解を得ることが理論的限界に達する複雑な供給網にも対応します。

* **手法**:
    * **Enumeration（列挙法）**: 切り詰められた状態空間に対する全探索（小規模ネットワークで最適性を保証）
    * **Coordinate Descent（座標降下法）**: 反復的な局所探索（高速、ヒューリスティック）
    * **シミュレーション最適化**: GPUによる並列計算や高度な勾配計算を活用し、伝統的な数理モデルが機能しない一般ネットワークにおいても実用的な最適解を導出
* **入力**: ネットワーク構造（ノードとエッジ）、局所/エシェロンコスト、リードタイム
* **出力**: 各ノードの最適基準在庫レベル ($S^*$)

---

## 7. ネットワークシミュレーターの活用

算出された最適パラメータを、実運用に投入する前に検証するための**「万能な実験場」**です。

### 7.1 Simulation（単一製品シミュレーション）

サプライチェーンネットワークの離散イベントシミュレーションを実行し、ポリシーの検証や経時的なパフォーマンス分析を行います。

* **可視化機能**: 時系列グラフにより、以下の推移をひと目で確認できます。
    * 🔴 **赤線**: 需要（Demand）の発生状況
    * 🟣 **紫線**: 在庫レベル（Inventory Level）の増減
    * ⚪ **灰色**: 発注量（Order Quantity）のタイミングと量
* **検証の役割**: 数理モデル上の仮定と現実の挙動に乖離がないか、パラメータを変更しながらシミュレーションを繰り返すことで、納得感のある在庫政策を策定できます。
* **入力**: 基準在庫レベルが定義されたネットワーク構造、シミュレーション期間
* **出力**: 各ノードの在庫レベル、発注量、需要の時系列プロット

### 7.2 マルチプロダクト・シミュレーション (Multi-Product Simulation)

部品表 (BOM) の関係を持つ複数製品のシナリオにおけるシミュレーションを実行します。

* **シナリオ例**: ノード1がノード2からの製品20と30を使用して製品10を組み立てる
* **入力**: シミュレーション期間、BOM比率、リードタイム、保持費用・欠品費用
* **出力**: 各ノードにおける各製品の在庫、発注、需要の時系列プロット

---

## 8. モデル選定のガイドライン

実務においてどのモデルを採用すべきか、以下の基準で判断してください。

### 需要の性質で選ぶ

| 需要の特性 | 推奨モデル |
|---|---|
| 需要がほぼ一定、または事前に確定 | EOQ（ハリスモデル）、ワグナー・ウィッティン法 |
| 需要が不確実でばらつく | ニュースベンダー、RQモデル、(s, S) ポリシー |
| 曜日などで需要の平均や分散が変化 | 有限期間動的モデル（DP） |

### ネットワーク構造で選ぶ

| ネットワーク構造 | 推奨モデル |
|---|---|
| 単一拠点 | 単一地点在庫モデル（EOQ, Newsvendor, RQ, SS 等） |
| 直列の多段階構造 | 直列ネットワークモデル（DPによる厳密解） |
| 複雑な供給網（多分岐） | GSM（計算速度優先）または一般ネットワーク・シミュレーション最適化（精度優先） |

### 計算コストと精度のトレードオフ

| 優先事項 | 推奨アプローチ |
|---|---|
| **計算速度重視** | 古典的モデルの公式利用、またはGSM |
| **精度重視** | 動的計画法（DP）やシミュレーション最適化 |

> [!TIP]
> 一般ネットワークの厳密な最適化は計算負荷が高いため、GPU等のリソース活用を検討してください。
