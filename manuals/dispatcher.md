# 配送最適化ソルバー MOAI-Dispatcher ユーザーマニュアル

## 1. アプリケーション概要

本アプリケーションは、複数の配送拠点、車両、および訪問先（顧客）の情報を基に、配送コストを最小化しつつ、時間枠や積載制限などの実務的な制約をすべて満たす最適な配送ルートを自動計算します。
複雑な集荷・配送の組み合わせや、途中の拠点での再積み込み、車両ごとの稼働時間管理を考慮した高度な計画立案を支援します。

## 2. 設定項目（入力データ）

各設定項目は、以下の通り分類されます。

### 2.1 訪問先（顧客）データ

訪問先の位置情報、配送・集荷量、および時間的な条件を設定します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 訪問先名 | 顧客や店舗の名称。 | 識別しやすい名前を推奨。 |
| 座標 (X/Y) | 訪問先の位置。 | 数値で入力してください。 |
| 配送量 | お届けする荷物の量。 | 品目別に複数設定可能です。 |
| 集荷量 | 回収する荷物の量。 | 品目別に複数設定可能です。 |
| 作業時間 | 訪問先での荷役やサービスにかかる時間。 | 0以上の値を入力してください。 |
| 受入開始可能時刻 | 荷受けやサービスを開始できる最も早い時刻。 | 0以上の値を入力してください。 |
| 受入終了時刻 | 荷受けやサービスを完了すべき最も遅い時刻。 | 開始可能時刻以降の値を入力。 |
| 準備完了時刻 | 荷物が準備でき、訪問が可能になる時刻。 | 0以上の値を入力してください。 |
| 訪問報酬 | その訪問先をルートに組み込んだ際に得られるメリット。 | 0以上の値を入力してください。 |
| 必須フラグ | 必ず訪問する必要があるかどうかの指定。 | True（必須）またはFalse。 |
| 所属グループ | 複数の訪問先をまとめて管理するための識別番号。 | 任意設定。 |

### 2.2 拠点（デポ）データ

車両の出発・帰還地点、および積み込みを行う場所の設定です。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 拠点名 | 配送センターや営業所の名称。 | 識別しやすい名前を推奨。 |
| 座標 (X/Y) | 拠点の位置。 | 数値で入力してください。 |
| 稼働開始時刻 | 拠点がオープンする時刻。 | 0以上の値を入力してください。 |
| 稼働終了時刻 | 拠点がクローズする時刻。 | 開始時刻以降の値を入力。 |
| 拠点作業時間 | 拠点での積み込み等にかかる付随時間。 | 0以上の値を入力してください。 |

### 2.3 車両種別データ

使用するトラックや車両の性能、コスト、稼働条件を設定します。

| 項目名 | 説明 | 入力上の注意 |
| --- | --- | --- |
| 車両種別名 | 「2tトラック」「軽バン」などの名称。 | 識別しやすい名前を推奨。 |
| 保有台数 | その車種を利用できる最大台数。 | 1以上の整数を入力してください。 |
| 最大積載量 | 車両に乗せられる荷物の制限。 | 品目（重量・容積等）ごとに設定。 |
| 出発拠点 | 運行を開始する拠点の番号。 | 拠点リストの番号を指定。 |
| 帰還拠点 | 運行を終了する拠点の番号。 | 拠点リストの番号を指定。 |
| 車両固定費 | 車両を1台稼働させるごとにかかる基本料金。 | 0以上の値を入力してください。 |
| 稼働開始可能時刻 | ドライバーのシフト開始など、運行開始できる時刻。 | 0以上の値を入力してください。 |
| 稼働終了時刻 | ドライバーのシフト終了など、帰還すべき時刻。 | 0以上の値を入力してください。 |
| 最大稼働時間 | 1回の運行（シフト）の最大時間。 | 0以上の値を入力してください。 |
| 最大走行距離 | 1回の運行で走行できる距離の上限。 | 0以上の値を入力してください。 |
| 距離単価 | 1km走行するごとに発生する変動費。 | 0以上の値を入力してください。 |
| 時間単価 | 1分（または1時間）稼働するごとに発生する費用。 | 0以上の値を入力してください。 |
| 走行特性 | 道路状況や速度制限（プロファイル）の指定。 | 適切な番号を選択してください。 |
| 積載済み荷物 | 出発時にあらかじめ積んでいる荷物の量。 | 最大積載量の範囲内で入力。 |
| 再積み込み拠点 | 途中で荷物の補充や荷下ろしができる拠点のリスト。 | 拠点番号を複数指定可能です。 |
| 最大再積み込み回数 | 1回の運行中に拠点に立ち寄れる回数の上限。 | 0以上の値を入力してください。 |
| 許容残業時間 | 稼働終了時刻を超えても良い最大時間。 | 0以上の値を入力してください。 |
| 残業単価 | 残業が発生した際の時間あたりの追加費用。 | 0以上の値を入力してください。 |

## 3. 適用されるルール（制約条件）

最適化計算において、以下のルールが厳守されます。

* **時間枠の遵守**: 各訪問先の受入時間内、および車両の稼働時間内に作業を行わなければなりません。
* **積載制限**: 走行中のどの時点においても、荷物の量が車両の最大積載量を超えてはなりません。
* **訪問必須条件**: 「必須フラグ」が設定されている訪問先は、必ずいずれかの車両のルートに組み込まれます。
* **拠点間移動**: 車両は指定された出発拠点から開始し、指定された帰還拠点に終了しなければなりません。
* **連続稼働制限**: 最大稼働時間や最大走行距離の設定がある場合、それを超えるルートは作成されません。
* **途中補充**: 指定された回数内で、特定の拠点に立ち寄り荷物を積み直す（再積み込み）ことが可能です。

## 4. 出力結果

計算の結果、以下の情報が得られます。

1. **最適配送ルート**: どの車両が、どの順番で、どの訪問先を回るかの一覧。
2. **スケジュール**: 各訪問先への到着予定時刻および作業開始・終了時刻。
3. **積載推移**: 各地点出発時の車両内の荷物量（積載率）。
4. **総コスト内訳**: 車両固定費、走行距離費用、作業時間費用、残業費用、および未訪問ペナルティ（任意設定時）を合算した総費用。
5. **稼働実績**: 各車両の総走行距離、総稼働時間、および残業時間。

## 5. アプリケーション操作ガイド

### サイドバー設定
* **Actions**:
    * **Load Sample Problem**: シンプルなサンプル問題を読み込みます。
* **Benchmark Loader**: 
    * **Benchmark Set**: データセットの種類を選択します（DIMACS, Solomonなど）。
    * **Select Instance**: 具体的な問題インスタンスを選択し、「Load Benchmark」ボタンで読み込みます。
* **Solve**:
    * **Time Limit (seconds)**: ソルバーの計算時間制限を設定します。
    * **Solve**: 最適化計算を実行します。

### Visualization / Result
* **Routes Summary**: 各車両のルート、距離、所要時間、積載量のサマリーテーブル。
* **Problem Instance**: 顧客位置とデポの散布図。
* **Solution Routes**: 最適化後の配送ルート図。